!function(a){"use strict";a.fn.gameTaquin=function(b,c){function k(a){var d,e,h,b=[],f=0,g=0;for(f=0;a>f;f+=1){for(d=[],g=0;a>g;g+=1)e=[],h=!0,0===f&&0===g&&"tl"===c.hidePart&&(h=!1),f===a-1&&0===g&&"tr"===c.hidePart&&(h=!1),0===f&&g===a-1&&"bl"===c.hidePart&&(h=!1),f===a-1&&g===a-1&&"br"===c.hidePart&&(h=!1),e[0]=h,e[1]="taquin-"+f+"-"+g,d[g]=e;b[f]=d}return b}function l(b){var c=b.attr("class").split(/\s+/),d="";return a.each(c,function(a,b){0===a&&(d=b)}),d}function m(a){var b=[],c=0,d=0;for(c=0;c<g.length;c+=1)for(d=0;d<g[0].length;d+=1)h[c][d][1]===a&&(b[0]=c,b[1]=d);return b}function n(){var a=[],b=0,c=0;for(b=0;b<g.length;b+=1)for(c=0;c<g[0].length;c+=1)h[b][c][0]===!1&&(a[0]=b,a[1]=c,a[2]=h[b][c][1]);return a}function o(a,b){var c=!1;try{h[a][b-1][0]===!1&&(c=!0)}catch(d){}try{h[a+1][b][0]===!1&&(c=!0)}catch(e){}try{h[a][b+1][0]===!1&&(c=!0)}catch(f){}try{h[a-1][b][0]===!1&&(c=!0)}catch(g){}return c}function p(b){var c,d,e,f=0,k=0,l=0,m=0,o=0,p=0,q=0,r=0,s=0;for(k=0;b>k;k+=1){c=n(),d=[],f=0;try{h[c[0]][c[1]-1][0]===!0&&(d[f]=[],d[f][0]=c[0],d[f][1]=c[1]-1,f+=1)}catch(t){}try{h[c[0]+1][c[1]][0]===!0&&(d[f]=[],d[f][0]=c[0]+1,d[f][1]=c[1],f+=1)}catch(u){}try{h[c[0]][c[1]+1][0]===!0&&(d[f]=[],d[f][0]=c[0],d[f][1]=c[1]+1,f+=1)}catch(v){}try{h[c[0]-1][c[1]][0]===!0&&(d[f]=[],d[f][0]=c[0]-1,d[f][1]=c[1],f+=1)}catch(w){}q=Math.floor(Math.random()*d.length),e=h[c[0]][c[1]],h[c[0]][c[1]]=h[d[q][0]][d[q][1]],h[d[q][0]][d[q][1]]=e}for(l=0;l<g.length;l+=1)for(m=0;m<g[0].length;m+=1)for(o=0;o<h.length;o+=1)for(p=0;p<h[0].length;p+=1)if(g[l][m][1]===h[o][p][1]){if(g[l][m][0]!==!0){a(".taquin-"+l+"-"+m).css({top:j*p,left:i*o});break}r=parseInt(j*p-a(".taquin-"+l+"-"+m).position().top,10)+"px",s=parseInt(i*o-a(".taquin-"+l+"-"+m).position().left,10)+"px",a(".taquin-"+l+"-"+m).animate({top:"+="+r,left:"+="+s})}}function q(b){b.find(".taquin-part").unbind("click");var d=n();a("."+d[2]).animate({opacity:"0"},function(){a(this).hide(),p(c.mixing),b.find(".taquin-part").clearQueue(),b.find(".taquin-part").bind("click",function(){f(b,a(this))})})}function r(d,e){var p,f=c.division,l=0,m=0,n=0,o=0;for(l=0!==parseInt(c.width,10)?c.width:e[0],m=0!==parseInt(c.height,10)?c.height:e[1],i=Math.round(l/f),j=Math.round(m/f),g=k(f),h=k(f),d.css({position:"relative",width:l+"px",height:m+"px"}),n=0;n<g.length;n+=1)for(o=0;o<g[0].length;o+=1)p=(0!=c.width?c.width:e[0])+"px "+(0!=c.height?c.height:e[1])+"px",a("<div>",{css:{cursor:"pointer",backgroundImage:"url('"+b+"')",backgroundPosition:"-"+parseInt(i*n,10)+"px -"+parseInt(j*o,10)+"px","background-size":p,position:"absolute",top:parseInt(j*o,10)+"px",left:parseInt(i*n,10)+"px",width:i+"px",height:j+"px"}}).appendTo(d).addClass(g[n][o][1]).addClass("taquin-part");d.find(".taquin-part").bind("click",function(){q(d)})}if(c=a.extend({width:0,height:0,division:4,hidePart:"br",mixing:200,success:"Complete"},c),c.division<2&&(c.division=2),!a.isFunction(c.success)){var e=c.success;c.success=function(){alert(e)}}var f,g,h,i=0,j=0;return f=function(b,d){var e,r,i=0,j=0,k=0,p=0,s=l(d),t=m(s),u=o(t[0],t[1]);u&&(e=n(),b.find("."+e[2]).show(),i=b.find("."+s).position().top-b.find("."+e[2]).position().top,j=b.find("."+s).position().left-b.find("."+e[2]).position().left,b.find("."+e[2]).hide(),k=d.position().top,p=d.position().left,r=h[t[0]][t[1]],h[t[0]][t[1]]=h[e[0]][e[1]],h[e[0]][e[1]]=r,d.unbind("click").animate({top:"-="+i,left:"-="+j},function(){if(d.bind("click",function(){f(b,d)}),h.toString()===g.toString()){b.find(".taquin-part").unbind("click");var e=n();a("."+e[2]).show().animate({opacity:"1"},function(){b.find(".taquin-part").bind("click",function(){q(b)}),c.success()})}}),b.find("."+e[2]).css({top:k+"px",left:p+"px"}))},this.each(function(){var c,d=new Image,e=a(this),f=[];d.src=b,c=setInterval(function(){if(0!==d.width){f[0]=d.width,f[1]=d.height;var b=a("<div>").addClass("taquin-generate");e.next().hasClass("taquin-generate")&&e.next().remove(),e.after(b),r(b,f),clearInterval(c)}},50)})}}(jQuery);